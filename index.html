<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MediaGrabber Pro: The all-in-one browser tool for secure image conversion, PDF password removal, and Smart OCR text extraction. Fast, free, and 100% private.">
    <title>MediaGrabber Pro | Secure Image Converter, OCR & PDF Tools</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/plugins/encryption.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

<!-- Favicons -->
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">



<style>

/* --- THE BRIGHTER PURPLE NEON GLOW --- */
input:focus, select:focus, textarea:focus {
    /* Brighter solid border */
    border-color: #a78bfa !important; 
    
    /* Layered box-shadow for a "Neon" effect */
    box-shadow: 0 0 15px rgba(124, 58, 237, 0.7), 
                0 0 5px rgba(167, 139, 250, 0.9); 
    
    /* Slightly more visible background tint */
    background: rgba(124, 58, 237, 0.1) !important; 
    
    outline: none;
    transition: all 0.2s ease-in-out;
}

/* Updated variable for a more electric purple */
:root {
    --purple: #8b5cf6; 
}


/* Styling the parent select box */
select#format {
    background-color: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
    cursor: pointer;
    appearance: none; /* Removes default browser arrow to allow custom styling */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1em;
}

/* Fix for Light Mode dropdown readability */
body.light-mode select#format {
    background-color: #f3f4f6;
    color: #111827;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
}

/* This targets the actual dropdown list in some browsers */
select#format option {
    background-color: #0b1020; /* Dark background for Dark Mode */
    color: #ffffff;
}

body.light-mode select#format option {
    background-color: #ffffff; /* Light background for Light Mode */
    color: #111827;
}



        :root {
            --purple: #7c3aed;
            --purple-light: #ddd6fe;
            --bg: #05070f;
            --card: rgba(255, 255, 255, 0.03);
            --text: #e5e7eb;
            --border: rgba(255, 255, 255, 0.1);
            --nav-bg: --purple: #7c3aed;
            --purple-light: #ddd6fe;
            --bg: #05070f;
            --card: rgba(255, 255, 255, 0.03);
            --text: #e5e7eb;
            --border: rgba(255, 255, 255, 0.1);
        }

        /* LIGHT MODE OVERRIDES */
        body.light-mode {
            --bg: #f9fafb;
            --card: #ffffff;
            --text: #111827;
            --border: rgba(0, 0, 0, 0.1);
            --nav-bg: rgba(255, 255, 255, 0.9);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: background 0.3s, color 0.3s; }
        
        body { 
            margin: 0; 
            background: radial-gradient(circle at top, #1a1033, var(--bg)); 
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        body.light-mode { background: var(--bg); }

        /* NAVIGATION BAR */
        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 5%;
            background: var(--nav-bg);
            backdrop-filter: blur(15px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
            
        }

        .logo-group {
            display: flex;
            align-items: center;
            height: 50px;
        }

        .main-logo {
            height: 420%;
            width: auto;
            object-fit: contain;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            color: #9ca3af;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        body.light-mode .nav-links a { color: #4b5563; }
        .nav-links a:hover { color: var(--purple); }

        .theme-toggle {
            cursor: pointer;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 8px;
            border-radius: 50%;
            display: flex;
            color: var(--text);
        }

        /* CONTENT STYLING */
        .container { max-width: 1000px; margin: auto; padding: 40px 20px; text-align: center; }
        
        .badge { 
            display: inline-block; padding: 6px 14px; 
            background: rgba(124, 58, 237, 0.15); 
            color: #a78bfa; border-radius: 999px; 
            font-size: 12px; font-weight: 600; border: 1px solid rgba(124, 58, 237, 0.3);
            margin-bottom: 20px;
        }

        h1 { font-size: 52px; margin: 10px 0; font-weight: 800; letter-spacing: -2px; }
        h1 span { color: var(--purple); }
        
        .subtitle { font-size: 18px; color: #9ca3af; max-width: 650px; margin: auto; }
        .section-title { margin-top: 60px; font-size: 32px; font-weight: 700; color: var(--text); }

        .card {
            margin-top: 40px;
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid var(--border);
            text-align: left;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed var(--purple);
            background: rgba(124, 58, 237, 0.05);
            border-radius: 20px; 
            padding: 40px; 
            text-align: center;
            cursor: pointer;
            display: block;
        }

        .preview-box {
            display: none; width: 100%; max-height: 250px; 
            object-fit: contain; margin: 20px 0; 
            border-radius: 12px; border: 1px solid var(--border);
        }

        select, input, textarea {
            width: 100%; padding: 14px; margin-top: 12px;
            border-radius: 12px; border: 1px solid var(--border);
            background: rgba(0,0,0,0.3); color: var(--text); outline: none;
        }

        body.light-mode select, body.light-mode input, body.light-mode textarea {
            background: #f3f4f6;
        }

        .btn-primary {
            background: var(--purple); color: #fff; border: none;
            font-weight: 700; cursor: pointer; padding: 16px;
            margin-top: 20px; border-radius: 14px; width: 100%;
        }

        .lang-stat-bar { height: 19px; background: #1f2937; border-radius: 6px; overflow: hidden; display: flex; margin: 20px 0; }
        .stat-segment { height: 100%; transition: width 0.5s ease; }

        footer { margin: 80px 0 40px; color: #6b7280; font-size: 14px; }



/* Neon Glow for Select Dropdowns */
.neon-select {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.3);
    color: var(--text);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
}

.neon-select:hover {
    border-color: var(--purple-neon);
    box-shadow: 0 0 15px rgba(124, 58, 237, 0.6);
    background: rgba(124, 58, 237, 0.1);
}

.file-item select:hover {
    border-color: var(--purple-neon);
    box-shadow: 0 0 10px rgba(124, 58, 237, 0.5);
}




/* Style the dropdown options */
.neon-select option {
    background-color: #1a1033; /* A deep dark purple for the list background */
    color: #e5e7eb; /* Light text */
    padding: 10px;
}

/* Style the specific "Select format for all" placeholder */
.neon-select option[disabled] {
    color: var(--purple-neon);
    font-weight: bold;
}

/* Hover effect for options (Works in some browsers) */
.neon-select option:hover, 
.neon-select option:focus {
    background-color: var(--purple) !important;
}



/* LIGHT MODE DROPDOWN COLORS */
body.light-mode .neon-select {
    background: #f3f4f6;
    color: #111827;
    border-color: rgba(0, 0, 0, 0.2);
}

body.light-mode .neon-select option {
    background-color: #ffffff; /* White background for options in Light Mode */
    color: #111827;            /* Dark text for readability */
}

body.light-mode .neon-select:hover {
    border-color: var(--purple);
    box-shadow: 0 0 10px rgba(124, 58, 237, 0.2);
    background: #ffffff;
}



/* Professional Red Delete Button */
.btn-del {
    background-color: #ef4444; /* Modern vibrant red */
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Hover Effect: Darkens slightly and adds a small shadow */
.btn-del:hover {
    background-color: #dc2626; 
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    transform: translateY(-1px);
}

/* Active Effect: Mimics a physical press */
.btn-del:active {
    transform: translateY(0px);
}



/* Copy Animation Bubble */
.copy-bubble {
    position: absolute;
    background: var(--purple);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    pointer-events: none;
    animation: bubbleUp 0.8s ease-out forwards;
    z-index: 1001;
    box-shadow: 0 4px 10px rgba(124, 58, 237, 0.4);
}

@keyframes bubbleUp {
    0% { opacity: 0; transform: translateY(0); }
    20% { opacity: 1; transform: translateY(-15px); }
    80% { opacity: 1; transform: translateY(-20px); }
    100% { opacity: 0; transform: translateY(-30px); }
}


    </style>
</head>

<body>

<nav>
    <div class="logo-group">
        <img id="logoImg" src="dark mode.png" alt="Media Grabber" class="main-logo">
    </div>
    
    <div class="nav-right">
        <div class="nav-links">
            <a href="#converter">Converter</a>
            <a href="#pdf">PDF Tool</a>
            <a href="#ocr">Smart OCR</a>
            <a href="#unlocker">PDF Unlocker</a>
        </div>

        <button class="theme-toggle" id="themeToggle" title="Toggle Light/Dark Mode">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>
    </div>
</nav>

<div class="container">
    <div class="badge">PRO v1.2.0 ‚Ä¢ Browser & PC-Only</div>

    <h1>One Tool.<br><span>Master Your Media.</span></h1>
    <p class="subtitle">Convert, combine, and extract. Professional-grade media tools that never leave your browser.</p>

 <h2 id="converter" class="section-title">Image Converter</h2>
<div class="card">
    <label class="upload-area" for="imgInput">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--purple)"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        <p style="margin-top:10px; font-weight:600">Click to upload images Supports JPG, PNG, WEBP, PSD, and more</p>
        <input type="file" id="imgInput" multiple accept="image/*" hidden onchange="handleConvFiles(this)">
    </label>

    <div id="globalFormatContainer" style="display:none; margin-top:20px; padding:15px; border: 1px dashed var(--purple); border-radius:12px; background:rgba(124, 58, 237, 0.05);">
        <p style="margin:0 0 10px 0; font-size:13px; font-weight:700; color:var(--purple-neon);">‚ö° BATCH ACTION: Set all files to:</p>
        <select id="globalFormat" onchange="setAllFormats(this.value)" class="neon-select">
            <option value="" disabled selected>Select format for all...</option>
            <option value="image/png">PNG (MOST USED üëë)</option>
            <option value="image/jpeg">JPG / JPEG (MOST USED üëë)</option>
            <option value="image/webp">WEBP</option> 
            <option value="image/bmp">BMP</option>
            <option value="image/gif">GIF</option>
            <option value="image/tiff">TIFF</option>
            <option value="image/avif">AVIF</option>
            <option value="image/heif">HEIF (IPHONE üì±)</option>
            <option value="image/svg+xml">SVG</option>
            <option value="image/vnd.adobe.photoshop">PSD</option>
        </select>
    </div>

    <div id="convFileList" class="file-list" style="display:none; margin-top:20px;"></div>
    
    <button class="btn-primary" onclick="convertAndDownloadOneByOne()">Convert & Download</button>
</div>



   <h2 id="pdf" class="section-title">Image to PDF</h2>
<div class="card">
    <p class="subtitle" style="text-align:left; margin-bottom:15px">Combine multiple images into a single professional document.</p>
    
    <label class="upload-area" for="pdfImgs">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--purple)"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        <p style="margin-top:5px; font-weight:600">Click to add images</p>
        <input type="file" id="pdfImgs" multiple accept="image/*" hidden onchange="handlePdfFiles(this)">
    </label>

    <div id="pdfFileList" class="file-list" style="display:none; margin-top:20px;"></div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:20px;">
        <input id="pdfName" placeholder="Document Name">
        <input id="pdfPass" type="password" placeholder="Set Password (Optional)">
    </div>
    <button class="btn-primary" onclick="makePDF()">Generate PDF</button>
</div>
<h2 id="ocr" class="section-title">Smart OCR</h2>
<div class="card">
    <label class="upload-area" for="ocrInput" style="border-style: dashed; border-width: 2px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--purple)">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        <p style="margin-top:15px; font-weight:600; font-size: 15px;">Click to upload document (Supports Images and PDF)</p>
        <input type="file" id="ocrInput" accept="image/*,application/pdf" hidden>
    </label>

<div id="ocrStatus" style="margin-top:10px; font-size:14px; color:var(--purple)">
    <span id="fileCountText">No files chosen</span>
</div>


    <button class="btn-primary" onclick="processOCR()">Analyze & Extract Text</button>
    
    <div id="ocrStatus" style="margin-top:15px; font-size:14px;"></div>
   
    <textarea id="ocrResult" placeholder="Extracted text will appear here..." style="margin-top: 20px;"></textarea>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px">
        <button class="btn-primary" onclick="copyOCRText(event)">üìã Copy</button>
        <button class="btn-primary" onclick="downloadText()">üìÑ .TXT</button>
        <button class="btn-primary" onclick="downloadOCRPDF()">üìï .PDF</button>
    </div>
</div><br> <br>


<h2 id="unlocker" class="section-title">Remove PDF Password</h2>  <a href="#unlocker"></a>
<div class="card">
    <p class="subtitle" style="text-align:left; margin-bottom:15px">Upload a locked PDF to create a decrypted version.</p>
    
    <label class="upload-area" for="unlockInput">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--purple)"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        <p style="margin-top:5px; font-weight:600">Click to upload Locked PDF</p>
        <input type="file" id="unlockInput" accept="application/pdf" hidden onchange="document.getElementById('unlockName').innerText = this.files[0].name">
    </label>
    
    <div id="unlockName" style="font-size:12px; color:var(--purple-neon); margin-top:10px; text-align:center;"></div>

    <div style="margin-top:20px;">
        <input id="unlockPass" type="password" placeholder="Enter Current PDF Password">
    </div>
    <button class="btn-primary" onclick="removePassword()">Decrypt & Download PDF</button>
    <div id="unlockStatus" style="margin-top:10px; font-size:14px; text-align:center;"></div>



    </div>

    <footer> ¬© 2026 MediaGrabber. MediaGrabber Pro is intended strictly for personal, non-commercial use with user-owned or non-copyrighted content. All media processing is performed locally within the user‚Äôs browser; no data is transmitted, monitored, or stored on external servers.</footer>
</div>

<script>
// --- THEME & LOGO TOGGLE ---
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const logoImg = document.getElementById('logoImg');

// Assets
const darkLogo = "dark mode.png"; 
const lightLogo = "light mode.png";

themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('light-mode');
    const isLight = document.body.classList.contains('light-mode');
    logoImg.src = isLight ? lightLogo : darkLogo;
    if(isLight) {
        themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
    } else {
        themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
    }
});

// --- GLOBAL UTILS ---
const redirectToFeedback = () => {
    if (sessionStorage.getItem("feedbackDone") === "true") return;
    setTimeout(() => { window.location.href = "index (2).html"; }, 1500);
};

// --- IMAGE PREVIEW LOGIC ---
document.getElementById("imgInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById("imgPreview");
    const pathText = document.getElementById("filePath");
    
    if(file) {
        pathText.textContent = `File: ${file.name}`;
        const reader = new FileReader();
        reader.onload = (ev) => {
            preview.src = ev.target.result;
            preview.style.display = "block";
        }
        reader.readAsDataURL(file);
    }
});

/* CONVERT FUNCTION */
async function convertImage() {
    const input = document.getElementById("imgInput");
    const uploaded = input.files[0];
    const format = document.getElementById("format").value;
    const name = (document.getElementById("fileName").value || "mediagrabber-export");

    if (!uploaded) return alert("Please select a file first");

    const btn = document.querySelector("button[onclick='convertImage()']");
    btn.disabled = true;
    btn.innerText = "Processing...";

    let fileToProcess = uploaded;

    if (uploaded.name.toLowerCase().endsWith(".heic") || uploaded.name.toLowerCase().endsWith(".heif")) {
        try {
            const blob = await heic2any({ blob: uploaded, toType: "image/jpeg", quality: 0.9 });
            fileToProcess = Array.isArray(blob) ? blob[0] : blob; 
        } catch (e) {
            console.error(e);
            btn.disabled = false;
            btn.innerText = "Convert & Download";
            return alert("‚ùå Error processing HEIC file. Your browser might not support this conversion.");
        }
    }

    if (format === "application/zip") {
        const zip = new JSZip();
        zip.file(fileToProcess.name || "image.jpg", fileToProcess);
        const content = await zip.generateAsync({ type: 'blob' });
        saveAs(content, `${name}.zip`);
        return;
    }

    const img = new Image();
    const url = URL.createObjectURL(fileToProcess);

    img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");

        if (format === "image/jpeg") {
            ctx.fillStyle = "#fff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        ctx.drawImage(img, 0, 0);

        canvas.toBlob(blob => {
            const a = document.createElement("a");
            let ext = format.split("/")[1].replace('jpeg', 'jpg').replace('svg+xml', 'svg').replace('vnd.adobe.photoshop', 'psd');
            a.href = URL.createObjectURL(blob);
            a.download = `${name}.${ext}`;
            a.click();
            URL.revokeObjectURL(a.href);
            URL.revokeObjectURL(url);
            btn.disabled = false;
            btn.innerText = "Convert & Download";
            if(typeof redirectToFeedback === "function") redirectToFeedback();
        }, format);
    };

    img.src = url;
}

function saveAs(blob, filename) {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);
    const btn = document.querySelector("button[onclick='convertImage()']");
    if (btn) { btn.disabled = false; btn.innerText = "Convert & Download"; }
}

async function makePDF() {
    const files = document.getElementById("pdfImgs").files;
    const pdfName = document.getElementById("pdfName").value || "merged-doc";
    const password = document.getElementById("pdfPass").value;

    if (!files.length) { alert("Upload images first"); return; }

    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4",
        encryption: password ? {
            userPassword: password,
            ownerPassword: password,
            userPermissions: ["print", "modify", "copy", "annot-forms"]
        } : undefined
    });

    for (let i = 0; i < files.length; i++) {
        const imgData = await new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(files[i]);
        });

        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, "JPEG", 10, 10, 190, 270);
    }

    pdf.save(`${pdfName}.pdf`);
    redirectToFeedback();
}

// PDF.js worker
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

// PRIVACY CHECKER
function checkPrivacy(canvas, statusElement) {
    const ctx = canvas.getContext("2d");
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
    let skinPixels = 0;
    for (let i = 0; i < imageData.length; i += 50 * 4) {
        const r = imageData[i], g = imageData[i+1], b = imageData[i+2];
        if (r > 60 && g > 40 && b > 20 && r > g && r > b && (Math.max(r,g,b) - Math.min(r,g,b) > 15)) {
            skinPixels++;
        }
    }
    const totalSampled = Math.max(1, imageData.length / (50 * 4));
    const humanLikelihood = (skinPixels / totalSampled) * 100;
    if (humanLikelihood > 8) {
        statusElement.style.color = "#ef4444";
        statusElement.innerText = "‚ö†Ô∏è PRIVACY BLOCK: Human presence detected. Processing stopped.";
        return false;
    }
    return true;
}

// OCR PROCESS
async function processOCR() {
    const file = document.getElementById("ocrInput").files[0];
    const status = document.getElementById("ocrStatus");
    const output = document.getElementById("ocrResult");

    if (!file) return alert("Please select a file!");
    status.style.color = "#a78bfa";
    status.innerText = "üîç Initializing...";
    output.value = "";

    try {
        let extractedText = "";

        if (file.type === "application/pdf") {
            const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
            for (let i = 1; i <= pdf.numPages; i++) {
                status.innerText = `üõ°Ô∏è Privacy Scan: Page ${i}...`;
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2 });
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                await page.render({ canvasContext: ctx, viewport: viewport }).promise;

                if (!checkPrivacy(canvas, status)) return;

                status.innerText = `üß† Extracting Text : Page ${i}...`;

                const ocrCanvas = document.createElement("canvas");
                ocrCanvas.width = canvas.width; ocrCanvas.height = canvas.height;
                const oCtx = ocrCanvas.getContext("2d");
                oCtx.filter = 'contrast(1.5) grayscale(1)';
                oCtx.drawImage(canvas, 0, 0);

                const res = await Tesseract.recognize(ocrCanvas.toDataURL(), 'eng+hin');
                extractedText += `--- Page ${i} ---\n${res.data.text}\n\n`;
            }
        } else {
            const img = await new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const i = new Image();
                    i.onload = () => resolve(i);
                    i.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });

            const canvas = document.createElement("canvas");
            canvas.width = img.width; canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);

            if (!checkPrivacy(canvas, status)) return;

            status.innerText = "üß† Extracting Text...";
            const res = await Tesseract.recognize(canvas.toDataURL(), 'eng+hin');
            extractedText = res.data.text;
        }

        output.value = extractedText;
        status.style.color = "#10b981";
        status.innerText = "‚úÖ Done!";
        renderLangStats(extractedText);
    } catch (e) {
        status.style.color = "#ef4444";
        const errMsg = (e && e.message) ? String(e.message) : '';
        const isPdf = (typeof file !== 'undefined' && file && file.type === 'application/pdf');
        const isPasswordError = isPdf && /password|encrypted|protected|passwordexception/i.test(errMsg);
        if (isPasswordError) {
            status.innerHTML = '‚ùå <strong>Security Protocol:</strong> This PDF is encrypted. Please utilize our <a href="#unlocker" style="color:var(--purple-neon); text-decoration:underline;">Security Unlocker</a> utility to remove restrictions before extraction.';
        } else {
            status.style.color = "#10b981";
            status.innerText = `‚úÖ Done!`;
        }
        console.error(e);
        return;
    }
}

function renderLangStats(text) {
    const bar = document.getElementById("statBar");
    const labels = document.getElementById("statLabels");
    if (!text || text.trim().length === 0) {
        document.getElementById("langStats").style.display = "none";
        return;
    }
    document.getElementById("langStats").style.display = "block";
    bar.innerHTML = '';
    const seg = document.createElement("div");
    seg.className = "stat-segment";
    seg.style.background = "linear-gradient(90deg,#8b5cf6,#a78bfa)";
    seg.style.width = "100%";
    bar.appendChild(seg);
    labels.innerText = `Characters: ${text.trim().length}`;
}

function validateOCRAction() {
    const t = document.getElementById("ocrResult").value.trim();
    if (!t) { alert("No OCR text available"); return false; }
    return true;
}

function copyOCRText(event) {
    if (!validateOCRAction()) return;
    
    const text = document.getElementById("ocrResult").value;
    
    // Copy to Clipboard
    navigator.clipboard.writeText(text).then(() => {
        // Create the bubble element
        const bubble = document.createElement("div");
        bubble.className = "copy-bubble";
        bubble.innerText = "Copied!";
        
        // Position it near the mouse click or the button
        const x = event.pageX;
        const y = event.pageY;
        bubble.style.left = `${x - 25}px`;
        bubble.style.top = `${y - 10}px`;
        
        document.body.appendChild(bubble);
        
        // Remove from DOM after animation finishes
        setTimeout(() => {
            bubble.remove();
        }, 800);
    });

    if(typeof redirectToFeedback === "function") redirectToFeedback();
}

function downloadText() {
    if (!validateOCRAction()) return;
    const text = document.getElementById("ocrResult").value;
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "extracted-text.txt";
    a.click();
    URL.revokeObjectURL(a.href);
    redirectToFeedback();
}

function downloadOCRPDF() {
    if (!validateOCRAction()) return;
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.text(document.getElementById("ocrResult").value, 10, 10, { maxWidth: 180 });
    pdf.save("extracted-text.pdf");
    redirectToFeedback();
}







let filesToConvert = [];

// 2. Handle selection & update the List View
function handleConvFiles(input) {
    const newFiles = Array.from(input.files);
    const filesWithFormat = newFiles.map(file => {
        file.targetFormat = "image/png"; // Default format
        return file;
    });
    filesToConvert = [...filesToConvert, ...filesWithFormat];
    renderConvList();
    input.value = ""; // Reset input so you can add the same file again if needed
}

// 3. Display the files with Name, Size, and Delete button
function renderConvList() {
    const listDiv = document.getElementById("convFileList");
    if (filesToConvert.length === 0) {
        listDiv.style.display = "none";
        return;
    }
    listDiv.style.display = "block";
    listDiv.innerHTML = filesToConvert.map((file, index) => `
        <div class="file-item" style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid var(--border);">
            <div class="file-info">
                <span class="file-name" style="font-size:14px; font-weight:600;">${file.name}</span>
                <span class="file-size" style="font-size:11px; color:#9ca3af;">${(file.size / 1024).toFixed(2)} KB</span>
            </div>

<button class="btn-del" onclick="removeConvFile(${index})">Delete</button>
        </div>
    `).join('');
}

// 4. Remove a specific file from the list
function removeConvFile(index) {
    filesToConvert.splice(index, 1);
    renderConvList();
}

async function convertAndDownloadOneByOne() {
    if (filesToConvert.length === 0) return alert("Please select images first!");
    
    const targetFormat = document.getElementById("format").value;
    const extension = targetFormat.split('/')[1].replace('jpeg', 'jpg').replace('svg+xml', 'svg');
    const btn = document.querySelector("button[onclick='convertAndDownloadOneByOne()']");
    
    btn.innerText = "‚è≥ Processing... Please wait";
    btn.disabled = true;

    for (let i = 0; i < filesToConvert.length; i++) {
        try {
            const blob = await new Promise((resolve, reject) => {
                const img = new Image();
                img.src = URL.createObjectURL(filesToConvert[i]);
                img.onload = () => {
                    const canvas = document.createElement("canvas");
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext("2d");
                    
                    if (targetFormat === "image/jpeg") { 
                        ctx.fillStyle = "#fff"; 
                        ctx.fillRect(0, 0, canvas.width, canvas.height); 
                    }
                    
                    ctx.drawImage(img, 0, 0);
                    canvas.toBlob((b) => {
                        URL.revokeObjectURL(img.src);
                        if (b) resolve(b);
                        else reject("Blob creation failed");
                    }, targetFormat, 0.95);
                };
                img.onerror = () => reject("Image load failed");
            });

            // CREATE DOWNLOAD LINK
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.style.display = "none";
            a.href = url;
            
            // Generate Filename
            const originalName = filesToConvert[i].name.split('.').slice(0, -1).join('.');
            a.download = `${originalName}.${extension}`;
            
            // TRIGGER
            document.body.appendChild(a);
            a.click();
            
            // CLEANUP (Wait before revoking URL)
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 500);

            // Chrome needs a healthy gap between "click" triggers
            // Increased to 500ms for stability
            await new Promise(res => setTimeout(res, 500));

        } catch (error) {
            console.error(`Error processing file  ${i + 1}:`, error);
        }
    }

    btn.innerText = "‚úÖ All Files Downloaded";
    setTimeout(() => {
        btn.innerText = "Convert & Download All (One by One)";
        btn.disabled = false;
    }, 2000);
    
    if(typeof redirectToFeedback === "function") redirectToFeedback();
}











// 1. Array to hold PDF files
let pdfFiles = [];

// 2. Handle adding files to the PDF list
function handlePdfFiles(input) {
    const newFiles = Array.from(input.files);
    pdfFiles = [...pdfFiles, ...newFiles];
    renderPdfList();
    input.value = ""; // Clear input
}

// 3. Render the PDF list (Name, Size, Delete)
function renderPdfList() {
    const listDiv = document.getElementById("pdfFileList");
    if (pdfFiles.length === 0) {
        listDiv.style.display = "none";
        return;
    }
    listDiv.style.display = "block";
    listDiv.innerHTML = pdfFiles.map((file, index) => `
        <div class="file-item" style="display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid var(--border);">
            <div class="file-info">
                <span class="file-name" style="font-size:14px; font-weight:600;">${file.name}</span>
                <span class="file-size" style="font-size:11px; color:#9ca3af;">${(file.size / 1024).toFixed(2)} KB</span>
            </div>
<button class="btn-del" onclick="removePdfFile(${index})">Delete</button>
        </div>
    `).join('');
}

// 4. Remove a file from the PDF list
function removePdfFile(index) {
    pdfFiles.splice(index, 1);
    renderPdfList();
}

// 5. Updated makePDF function using the pdfFiles array
async function makePDF() {
    if (pdfFiles.length === 0) return alert("Please add images for your PDF first!");

    const pdfName = document.getElementById("pdfName").value || "merged-doc";
    const password = document.getElementById("pdfPass").value;
    const btn = document.querySelector("button[onclick='makePDF()']");
    
    btn.disabled = true;
    btn.innerText = "‚è≥ Generating PDF...";

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4",
        encryption: password ? {
            userPassword: password,
            ownerPassword: password,
            userPermissions: ["print", "modify", "copy", "annot-forms"]
        } : undefined
    });

    for (let i = 0; i < pdfFiles.length; i++) {
        const imgData = await new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(pdfFiles[i]);
        });

        if (i > 0) pdf.addPage();
        
        // Proper scaling for A4 (210mm x 297mm)
        // Leaving a 10mm margin
        pdf.addImage(imgData, "JPEG", 10, 10, 190, 270);
    }

    pdf.save(`${pdfName}.pdf`);
    
    btn.disabled = false;
    btn.innerText = "Generate PDF";
    
    if(typeof redirectToFeedback === "function") redirectToFeedback();
}









function handleConvFiles(input) {
    const newFiles = Array.from(input.files);
    // We add a 'targetFormat' property to each file object
    const filesWithFormat = newFiles.map(file => {
        file.targetFormat = "image/png"; // Default format
        return file;
    });
    filesToConvert = [...filesToConvert, ...filesWithFormat];
    renderConvList();
    input.value = ""; 
}

// Function to update the format choice for a specific file
function updateFileFormat(index, format) {
    filesToConvert[index].targetFormat = format;
}

function renderConvList() {
    const listDiv = document.getElementById("convFileList");
    if (filesToConvert.length === 0) {
        listDiv.style.display = "none";
        return;
    }
    listDiv.style.display = "block";
    listDiv.innerHTML = filesToConvert.map((file, index) => `
        <div class="file-item" style="display:grid; grid-template-columns: 1fr auto auto; gap:15px; align-items:center; padding:15px; border-bottom:1px solid var(--border);">
            <div class="file-info">
                <span class="file-name" style="font-size:14px; font-weight:600; display:block; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${file.name}</span>
                <span class="file-size" style="font-size:11px; color:#9ca3af;">${(file.size / 1024).toFixed(2)} KB</span>
            </div>
            
            <select onchange="updateFileFormat(${index}, this.value)" style="padding:5px; font-size:12px; border-radius:8px; background:rgba(255,255,255,0.05); color:var(--purple); border:1px solid var(--purple); width:130px;">
                <option value="image/png" ${file.targetFormat === "image/png" ? "selected" : ""}>PNG</option>
                <option value="image/jpeg" ${file.targetFormat === "image/jpeg" ? "selected" : ""}>JPG</option>
                <option value="image/webp" ${file.targetFormat === "image/webp" ? "selected" : ""}>WEBP</option>
                <option value="image/bmp" ${file.targetFormat === "image/bmp" ? "selected" : ""}>BMP</option>
                <option value="image/tiff" ${file.targetFormat === "image/tiff" ? "selected" : ""}>TIFF</option>
            </select>

            <button class="btn-del" onclick="removeConvFile(${index})" style="background:#ef4444; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">Delete</button>
        </div>
    `).join('');
}

async function convertAndDownloadOneByOne() {
    if (filesToConvert.length === 0) return alert("Please select images first!");
    
    const btn = document.querySelector("button[onclick='convertAndDownloadOneByOne()']");
    btn.innerText = "‚è≥ Processing Custom Formats...";
    btn.disabled = true;

    for (let i = 0; i < filesToConvert.length; i++) {
        const currentFile = filesToConvert[i];
        const targetFormat = currentFile.targetFormat; // Get format chosen for THIS file
        const extension = targetFormat.split('/')[1].replace('jpeg', 'jpg').replace('svg+xml', 'svg');

        const blob = await new Promise(resolve => {
            const img = new Image();
            img.src = URL.createObjectURL(currentFile);
            img.onload = () => {
                const canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext("2d");
                if (targetFormat === "image/jpeg") { ctx.fillStyle = "#fff"; ctx.fillRect(0,0,canvas.width,canvas.height); }
                ctx.drawImage(img, 0, 0);
                canvas.toBlob(resolve, targetFormat, 0.9);
            };
        });

        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        const originalName = currentFile.name.split('.').slice(0, -1).join('.');
        a.download = `${originalName}.${extension}`;
        document.body.appendChild(a);
        a.click();
        
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 500);

        await new Promise(res => setTimeout(res, 600)); // Delay for stability
    }

    btn.innerText = "Convert & Download All (Custom Formats)";
    btn.disabled = false;
}



function removeConvFile(index) {
    filesToConvert.splice(index, 1);
    renderConvList(); // This refreshes the list after deleting
}






function handleConvFiles(input) {
    const newFiles = Array.from(input.files);
    const filesWithFormat = newFiles.map(file => {
        file.targetFormat = "image/png"; // Default
        return file;
    });
    filesToConvert = [...filesToConvert, ...filesWithFormat];
    renderConvList();
    input.value = ""; 
}

// Function to update ALL files at once
function setAllFormats(formatValue) {
    if(!formatValue) return;
    filesToConvert.forEach(file => {
        file.targetFormat = formatValue;
    });
    renderConvList(); // Refresh the UI to show changes
}

function updateFileFormat(index, format) {
    filesToConvert[index].targetFormat = format;
}

function removeConvFile(index) {
    filesToConvert.splice(index, 1);
    renderConvList();
}

function renderConvList() {
    const listDiv = document.getElementById("convFileList");
    const globalContainer = document.getElementById("globalFormatContainer");

    if (filesToConvert.length === 0) {
        listDiv.style.display = "none";
        globalContainer.style.display = "none";
        return;
    }

    // Show global selector only if there are 2 or more files
    globalContainer.style.display = filesToConvert.length >= 2 ? "block" : "none";
    listDiv.style.display = "block";

    listDiv.innerHTML = filesToConvert.map((file, index) => `
        <div class="file-item" style="display:grid; grid-template-columns: 1fr auto auto; gap:15px; align-items:center; padding:15px; border-bottom:1px solid var(--border);">
            <div class="file-info">
                <span class="file-name" style="font-size:14px; font-weight:600; display:block; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${file.name}</span>
                <span class="file-size" style="font-size:11px; color:#9ca3af;">${(file.size / 1024).toFixed(2)} KB</span>
            </div>
            
            <select onchange="updateFileFormat(${index}, this.value)" class="neon-select" style="width:130px; font-size:12px; padding:5px;">
                <option value="image/png" ${file.targetFormat === "image/png" ? "selected" : ""}>PNG</option>
                <option value="image/jpeg" ${file.targetFormat === "image/jpeg" ? "selected" : ""}>JPG</option>
                <option value="image/webp" ${file.targetFormat === "image/webp" ? "selected" : ""}>WEBP</option>
                <option value="image/bmp" ${file.targetFormat === "image/bmp" ? "selected" : ""}>BMP</option>
                <option value="image/gif" ${file.targetFormat === "image/gif" ? "selected" : ""}>GIF</option>
                <option value="image/tiff" ${file.targetFormat === "image/tiff" ? "selected" : ""}>TIFF</option>
                <option value="image/avif" ${file.targetFormat === "image/avif" ? "selected" : ""}>AVIF</option>
                <option value="image/heif" ${file.targetFormat === "image/heif" ? "selected" : ""}>HEIF</option>
                <option value="image/svg+xml" ${file.targetFormat === "image/svg+xml" ? "selected" : ""}>SVG</option>
                <option value="image/vnd.adobe.photoshop" ${file.targetFormat === "image/vnd.adobe.photoshop" ? "selected" : ""}>PSD</option>
            </select>

            <button class="btn-del" onclick="removeConvFile(${index})">Delete</button>
        </div>
    `).join('');
}




async function removePassword() {
    const file = document.getElementById("unlockInput").files[0];
    const password = document.getElementById("unlockPass").value;
    const status = document.getElementById("unlockStatus");
    const btn = document.querySelector("button[onclick='removePassword()']");

    if (!file) return alert("Please upload a PDF first!");

    btn.disabled = true;
    btn.innerText = "‚è≥ Initializing...";
    status.innerText = "Checking file security...";
    status.style.color = "var(--purple-neon)";

    try {
        const arrayBuffer = await file.arrayBuffer();
        
        // Step 1: Try loading the PDF without a password first
        let loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
        let pdf;
        
        try {
            pdf = await loadingTask.promise;
            
            // If it succeeds here, it means the file is NOT password protected
            status.style.color = "#a78bfa";
            status.innerHTML = "üí° <strong>Notice:</strong> This PDF is already unlocked and does not contain a password.";
            btn.disabled = false;
            btn.innerText = "Decrypt & Download PDF";
            return; // Stop processing since there is no lock
            
        } catch (err) {
            // If loadingTask fails with a PasswordException, proceed to unlock
            if (err.name === "PasswordException") {
                if (!password) {
                    status.style.color = "#ef4444";
                    status.innerText = "üîë This file is protected. Please enter the password to proceed.";
                    btn.disabled = false;
                    btn.innerText = "Decrypt & Download PDF";
                    return;
                }
                
                // Re-try with the provided password
                loadingTask = pdfjsLib.getDocument({
                    data: arrayBuffer,
                    password: password
                });
                pdf = await loadingTask.promise;
            } else {
                throw err; // Pass other errors to the main catch block
            }
        }

        // Step 2: Proceed with decryption if a password was successfully used
        const { jsPDF } = window.jspdf;
        const outPdf = new jsPDF();

        for (let i = 1; i <= pdf.numPages; i++) {
            status.innerText = `Processing Page ${i} of ${pdf.numPages}...`;
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: 2 });
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({ canvasContext: ctx, viewport: viewport }).promise;
            const imgData = canvas.toDataURL("image/jpeg", 0.95);
            
            if (i > 1) outPdf.addPage();
            const pdfWidth = outPdf.internal.pageSize.getWidth();
            const pdfHeight = outPdf.internal.pageSize.getHeight();
            outPdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
        }

        outPdf.save("unlocked_" + file.name);
        status.innerText = "‚úÖ Successfully Unlocked!";
        status.style.color = "#10b981";

    } catch (error) {
        console.error(error);
        status.innerText = "‚ùå Decryption Failed: Incorrect password or corrupted file.";
        status.style.color = "#ef4444";
    } finally {
        btn.disabled = false;
        btn.innerText = "Decrypt & Download PDF";
    }
}


document.getElementById('ocrInput').addEventListener('change', function() {
    const fileCount = this.files.length;
    const statusText = document.getElementById('fileCountText');
    
    if (fileCount > 0) {
        statusText.innerHTML = `üìÇ <b>${fileCount}</b> file(s) selected`;
    } else {
        statusText.innerText = "No files chosen";
    }
});


</script>
</body>

</html>

