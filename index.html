<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaGrabber Pro</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/plugins/encryption.min.js"></script>


    <style>


/* PRIVACY TOGGLE STYLING */
.privacy-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(124, 58, 237, 0.1);
    padding: 12px 20px;
    border-radius: 12px;
    margin-bottom: 15px;
    border: 1px solid rgba(124, 58, 237, 0.2);
}

.switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 22px;
}

.switch input { opacity: 0; width: 0; height: 0; }

.slider {
    position: absolute; cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #374151;
    transition: .4s; border-radius: 34px;
}

.slider:before {
    position: absolute; content: "";
    height: 16px; width: 16px; left: 3px; bottom: 3px;
    background-color: white; transition: .4s; border-radius: 50%;
}

input:checked + .slider { background-color: var(--purple); }
input:checked + .slider:before { transform: translateX(22px); }









        :root {
            --purple: #7c3aed;
            --purple-light: #ddd6fe;
            --bg: #05070f;
            --card: rgba(255, 255, 255, 0.03);
            --text: #e5e7eb;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { 
            margin: 0; 
            background: radial-gradient(circle at top, #1a1033, var(--bg)); 
            color: var(--text);
            line-height: 1.6;
        }

        .container { max-width: 1000px; margin: auto; padding: 60px 20px; text-align: center; }
        
        .badge { 
            display: inline-block; padding: 6px 14px; 
            background: rgba(124, 58, 237, 0.2); 
            color: #a78bfa; border-radius: 999px; 
            font-size: 13px; font-weight: 600; border: 1px solid rgba(124, 58, 237, 0.3);
        }

        h1 { font-size: 56px; margin: 15px 0; font-weight: 800; letter-spacing: -2px; }
        h1 span { color: #a78bfa; text-shadow: 0 0 30px rgba(124, 58, 237, 0.4); }
        
        .subtitle { font-size: 18px; color: #9ca3af; max-width: 650px; margin: auto; }
        .section-title { margin-top: 80px; font-size: 32px; font-weight: 700; color: #fff; }

        /* ADVANCED CARD SYSTEM */
        .card {
            margin-top: 40px;
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid var(--border);
            text-align: left;
            transition: transform 0.3s ease;
        }
        .card:hover { border-color: rgba(124, 58, 237, 0.4); }

        .upload-area {
            border: 2px dashed var(--purple-light);
            background: rgba(124, 58, 237, 0.05);
            border-radius: 20px; 
            padding: 40px; 
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            display: block;
        }
        .upload-area:hover { background: rgba(124, 58, 237, 0.1); border-color: var(--purple); }

        /* PREVIEW BOX */
        .preview-box {
            display: none;
            width: 100%;
            max-height: 250px;
            object-fit: contain;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        select, input, textarea {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
            color: #fff;
            outline: none;
        }
        select:focus, input:focus { border-color: var(--purple); }

        .btn-primary {
            background: var(--purple);
            color: #fff;
            border: none;
            font-weight: 700;
            cursor: pointer;
            padding: 16px;
            margin-top: 20px;
            border-radius: 14px;
            transition: 0.3s;
            font-size: 16px;
        }
        .btn-primary:hover { 
            background: #8b5cf6; 
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(124, 58, 237, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: #fff;
            margin-top: 10px;
        }

        /* OCR PROGRESS */
        .lang-stat-bar {
            height: 19px;
            background: #1f2937;
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            margin: 20px 0;
        }
        .stat-segment { height: 100%; transition: width 0.5s ease; }

        footer { margin: 100px 0 40px; color: #6b7280; font-size: 14px; }
    </style>
</head>

<body>

<div class="container">
    <div class="badge">PRO v1.2.0 ‚Ä¢ Browser & PC-Only  </div>

    <h1>One Tool.<br><span>Master Your Media.</span></h1>
    <p class="subtitle">Convert, combine, and extract. Professional-grade media tools that never leave your browser.</p>

    <h2 class="section-title">Image Converter</h2>
    <div class="card">
        <label class="upload-area" for="imgInput">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--purple)"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            <p style="margin-top:10px; font-weight:600">Click to upload image</p>
            <span id="filePath" style="font-size:12px; color:#9ca3af">Supports JPG, PNG, WEBP, PSD, and more</span>
            <input type="file" id="imgInput" accept="image/*" hidden>
        </label>
        
        <img id="imgPreview" class="preview-box">

        <div style="margin-top:20px">
            <label style="font-size:12px; color:#a855f7; font-weight:800; letter-spacing: 1px;">TARGET FORMAT</label>

<select id="format" style="
    color: #a855f7; 
    font-weight: 800; 
    border: 2px solid rgba(168, 85, 247, 0.4); 
    background: rgba(168, 85, 247, 0.05);
    text-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
    cursor: pointer;">
    
    <option value="image/png" style="background: #0b1020; color: #fff;">Convert to PNG (MOST USED üëë)</option>
    <option value="image/jpeg" style="background: #0b1020; color: #fff;">Convert to JPG / JPEG (MOST USED üëë)</option>
    <option value="image/heif" style="background: #0b1020; color: #fff;">Convert to HEIF (IPHONE FORMAT üì±)</option>
    <option value="application/zip" style="background: #0b1020; color: #fff;">Convert to ZIP (COMPRESSED üì¶)</option>
    <option value="image/webp" style="background: #0b1020; color: #fff;">Convert to WEBP</option> 
    <option value="image/bmp" style="background: #0b1020; color: #fff;">Convert to BMP</option>
    <option value="image/gif" style="background: #0b1020; color: #fff;">Convert to GIF</option>
    <option value="image/avif" style="background: #0b1020; color: #fff;">Convert to AVIF</option>
    <option value="image/tiff" style="background: #0b1020; color: #fff;">Convert to TIFF</option>
    <option value="image/svg+xml" style="background: #0b1020; color: #fff;">Convert to SVG</option>
    <option value="image/raw" style="background: #0b1020; color: #fff;">Convert to RAW</option>
    <option value="image/vnd.adobe.photoshop" style="background: #0b1020; color: #fff;">Convert to PSD (PHOTOSHOP)</option>
</select>

            <input id="fileName" placeholder="New filename (optional)">
            <button class="btn-primary" onclick="convertImage()">Convert & Download</button>
        </div>
    </div>

    <h2 class="section-title">Image to PDF</h2>
    <div class="card">
        <p class="subtitle" style="text-align:left; margin-bottom:15px">Select multiple images to combine into a single document.</p>
        <input type="file" id="pdfImgs" multiple accept="image/*">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px">
            <input id="pdfName" placeholder="Document Name">
            <input id="pdfPass" type="password" placeholder="Set Password (Optional)">
        </div>
        <button class="btn-primary" onclick="makePDF()">Generate PDF</button>
    </div>

    <h2 class="section-title">Smart OCR</h2>
    <div class="card">
        <p class="subtitle" style="text-align:left; margin-bottom:15px"> Extract text from images with accurate support for English and Hindi Only.</p>
        <input type="file" id="ocrInput" accept="image/*">




        <button class="btn-primary" onclick="imageToText()">Analyze & Extract Text</button>

        <div id="ocrStatus" style="margin-top:px; font-size:14px; color:#a78bfa"></div>

        <div id="langStats" style="display:none">
            <div class="lang-stat-bar" id="statBar"></div>
            <p id="statLabels" style="font-size:12px; color:#9ca3af"></p>
        </div>

        <textarea id="ocrResult" placeholder="Your extracted text will appear here..."></textarea>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px">
            <button class="btn-secondary btn-primary" onclick="copyOCRText()">üìã Copy</button>
            <button class="btn-secondary btn-primary" onclick="downloadText()">üìÑ .TXT</button>
            <button class="btn-secondary btn-primary" onclick="downloadOCRPDF()">üìï .PDF</button>
        </div>
    </div>

    <footer>
        ¬© 2026 MediaGrabber. MediaGrabber Pro is intended strictly for personal, non-commercial use with user-owned or non-copyrighted content. All media processing is performed locally within the user‚Äôs browser; no data is transmitted, monitored, or stored on external servers.
    </footer>
</div>

<script>
// --- GLOBAL UTILS ---
const redirectToFeedback = () => {
    // Block feedback ONLY for the current session
    if (sessionStorage.getItem("feedbackDone") === "true") {
        return;
    }

    setTimeout(() => {
        window.location.href = "index (2).html";
    }, 1500);
};

// --- IMAGE PREVIEW LOGIC ---
document.getElementById("imgInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById("imgPreview");
    const pathText = document.getElementById("filePath");
    
    if(file) {
        pathText.textContent = `File: ${file.name}`;
        const reader = new FileReader();
        reader.onload = (e) => {
            preview.src = e.target.result;
            preview.style.display = "block";
        }
        reader.readAsDataURL(file);
    }
});

/* üî• FULL UPGRADED CONVERT FUNCTION */
async function convertImage() {
    const input = document.getElementById("imgInput");
    const uploaded = input.files[0];
    const status = document.getElementById("statusMsg"); // Make sure you have this div or change to 'alert'
    const format = document.getElementById("format").value;
    const name = (document.getElementById("fileName").value || "mediagrabber-export");

    if (!uploaded) return alert("Please select a file first");

    // 1. Loading State
    const btn = document.querySelector("button[onclick='convertImage()']");
    btn.disabled = true;
    btn.innerText = "Processing...";

    let fileToProcess = uploaded;

    // ‚úÖ NEW HEIC SUPPORT LOGIC
    // This part converts Apple's HEIC into a JPEG so the browser's Canvas can read it
    if (uploaded.name.toLowerCase().endsWith(".heic") || uploaded.name.toLowerCase().endsWith(".heif")) {
        try {
            const blob = await heic2any({
                blob: uploaded,
                toType: "image/jpeg",
                quality: 0.9
            });
            // if heic2any returns an array, take the first item
            fileToProcess = Array.isArray(blob) ? blob[0] : blob; 
        } catch (e) {
            console.error(e);
            btn.disabled = false;
            btn.innerText = "Convert & Download";
            return alert("‚ùå Error processing HEIC file. Your browser might not support this conversion.");
        }
    }

    // 2. ZIP HANDLING (Special Case)
    if (format === "application/zip") {
        const zip = new JSZip();
        zip.file(fileToProcess.name || "image.jpg", fileToProcess);
        const content = await zip.generateAsync({ type: 'blob' });
        saveAs(content, `${name}.zip`);
        return;
    }

    // 3. CANVAS CONVERSION (For PNG, JPG, WEBP, etc.)
    const img = new Image();
    const url = URL.createObjectURL(fileToProcess);

    img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");

        // Fill background for JPEGs (to avoid black transparency)
        if (format === "image/jpeg") {
            ctx.fillStyle = "#fff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        ctx.drawImage(img, 0, 0);

        canvas.toBlob(blob => {
            const a = document.createElement("a");
            // Set correct extension
            let ext = format.split("/")[1].replace('jpeg', 'jpg').replace('svg+xml', 'svg').replace('vnd.adobe.photoshop', 'psd');
            
            a.href = URL.createObjectURL(blob);
            a.download = `${name}.${ext}`;
            a.click();
            
            // Cleanup & Reset UI
            URL.revokeObjectURL(a.href);
            URL.revokeObjectURL(url);
            btn.disabled = false;
            btn.innerText = "Convert & Download";
            
            // Redirect to feedback
            if(typeof redirectToFeedback === "function") redirectToFeedback();
        }, format);
    };

    img.src = url;
}

// Helper for ZIP (optional, depends if you use FileSaver.js or standard link)
function saveAs(blob, filename) {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);
    const btn = document.querySelector("button[onclick='convertImage()']");
    btn.disabled = false;
    btn.innerText = "Convert & Download";
}
async function makePDF() {
    const files = document.getElementById("pdfImgs").files;
    const pdfName = document.getElementById("pdfName").value || "merged-doc";
    const password = document.getElementById("pdfPass").value;

    if (!files.length) {
        alert("Upload images first");
        return;
    }

    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4",
        encryption: password
            ? {
                userPassword: password,
                ownerPassword: password,
                userPermissions: ["print", "modify", "copy", "annot-forms"]
            }
            : undefined
    });

    for (let i = 0; i < files.length; i++) {
        const imgData = await new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(files[i]);
        });

        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, "JPEG", 10, 10, 190, 270);
    }

    pdf.save(`${pdfName}.pdf`);

    redirectToFeedback();
}

// --- ADVANCED OCR LOGIC WITH PRE-PROCESSING ---
async function imageToText() {
    const file = document.getElementById("ocrInput").files[0];
    const status = document.getElementById("ocrStatus");
    const output = document.getElementById("ocrResult");

    if(!file) return alert("Please upload an image first");
    
    status.style.color = "#a78bfa";
    status.innerText = "üîç Processing...";
    output.value = "";

    try {
        const img = new Image();
        const url = URL.createObjectURL(file);
        await new Promise(res => { img.onload = res; img.src = url; });

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        // --- üõ°Ô∏è MANDATORY BACKGROUND PRIVACY CHECK (ALWAYS ON) ---
        status.innerText = "üõ°Ô∏è Privacy Scan: Checking for human presence...";
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let skinPixels = 0;

        // Sample pixels to detect human skin tone clusters
        for (let i = 0; i < imageData.length; i += 25) { 
            const r = imageData[i], g = imageData[i+1], b = imageData[i+2];
            // Standard computer vision skin-tone detection
            if (r > 60 && g > 40 && b > 20 && r > g && r > b && (Math.max(r,g,b) - Math.min(r,g,b) > 15)) {
                skinPixels++;
            }
        }

        const humanLikelihood = (skinPixels / (imageData.length / 25)) * 100;
        
        // Block if human presence exceeds the threshold
        if (humanLikelihood > 8) { 
            status.style.color = "#ef4444";
            status.innerText = "‚ö†Ô∏è PRIVACY BLOCK: This tool cannot process images containing people for security reasons.";
            URL.revokeObjectURL(url);
            return; // Terminate conversion
        }

        // --- üß† PROCEED TO OCR ONLY IF CHECK PASSES ---
        status.innerText = "üß† Analyzing text patterns...";
        const scale = img.width < 1000 ? 2 : 1;
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        ctx.filter = "contrast(1.3) grayscale(1)";
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        const result = await Tesseract.recognize(canvas.toDataURL(), 'eng+hin+ara', {
            logger: m => { if(m.status === 'recognizing text') status.innerText = `Progress: ${Math.round(m.progress * 100)}%`; }
        });

        output.value = result.data.text;
        status.innerText = "‚úÖ Extraction Complete";
        renderLangStats(result.data.text);
        URL.revokeObjectURL(url);

    } catch(e) {
        status.innerText = "‚ùå Error.";
    }
}
function renderLangStats(text) {
    const counts = { eng: 0, hin: 0, ara: 0 };
    for(let char of text) {
        const code = char.charCodeAt(0);
        if(code >= 65 && code <= 122) counts.eng++;
        else if(code >= 2304 && code <= 2431) counts.hin++;
        else if(code >= 1536 && code <= 1791) counts.ara++;
    }
    const total = counts.eng + counts.hin + counts.ara || 1;
    
    const statsDiv = document.getElementById("langStats");
    const bar = document.getElementById("statBar");
    statsDiv.style.display = "block";
    
    bar.innerHTML = `
        <div class="stat-segment" style="width:${(counts.eng/total)*100}%; background:#7c3aed"></div>
        <div class="stat-segment" style="width:${(counts.hin/total)*100}%; background:#f59e0b"></div>
        <div class="stat-segment" style="width:${(counts.ara/total)*100}%; background:#10b981"></div>
    `;
    document.getElementById("statLabels").innerText = `English: ${Math.round(counts.eng/total*100)}% | Hindi: ${Math.round(counts.hin/total*100)}% | Arabic: ${Math.round(counts.ara/total*100)}%`;
}

function validateOCRAction() {
    const fileSelected = document.getElementById("ocrInput").files.length > 0;
    const text = document.getElementById("ocrResult").value.trim();

    if (!fileSelected) {
        alert("Please select an image file first.");
        return false;
    }

    if (!text) {
        alert("Nothing to copy. Please extract text first.");
        return false;
    }

    return true;
}



function copyOCRText() {
    if (!validateOCRAction()) return;

    const text = document.getElementById("ocrResult").value;
    navigator.clipboard.writeText(text);
    alert("Text copied successfully.");
    redirectToFeedback();
}


function downloadText() {
    if (!validateOCRAction()) return;

    const text = document.getElementById("ocrResult").value;
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "extracted-text.txt";
    a.click();
    URL.revokeObjectURL(a.href);
    redirectToFeedback();
}
  
function downloadOCRPDF() {
    if (!validateOCRAction()) return;

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.text(document.getElementById("ocrResult").value, 10, 10, { maxWidth: 180 });
    pdf.save("extracted-text.pdf");
    redirectToFeedback();
}

</script>
</body>
</html>
